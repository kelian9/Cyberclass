{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport styles from './Profile.module.scss';\nimport Link from 'next/link';\nimport { ProfileAPI } from '../../api/profile';\nimport useFormState from '../../common/customHooks/useFormState';\nimport { setMaterials } from '../../store/actions/materials-actions';\nimport { LessonsAPI } from '../../api/lessons';\n\nvar Profile = function Profile(_ref) {\n  var store = _ref.store;\n  var materialsState = store.getState().MaterialsReducer;\n\n  var _useState = useState(''),\n      lessonsURL = _useState[0],\n      setLessonURL = _useState[1];\n\n  var _useState2 = useState(null),\n      avatar = _useState2[0],\n      setAvatarState = _useState2[1];\n\n  var profileData = {\n    nickName: useFormState(''),\n    email: useFormState(''),\n    vk: useFormState(''),\n    facebook: useFormState(''),\n    instagram: useFormState(''),\n    twitch: useFormState('')\n  };\n\n  var setLocalState = function setLocalState(profile) {\n    profileData.nickName.onChange({\n      target: {\n        value: profile.nickName\n      }\n    });\n    profileData.email.onChange({\n      target: {\n        value: profile.email\n      }\n    });\n    profileData.vk.onChange({\n      target: {\n        value: profile.vk\n      }\n    });\n    profileData.facebook.onChange({\n      target: {\n        value: profile.facebook\n      }\n    });\n    profileData.instagram.onChange({\n      target: {\n        value: profile.instagram\n      }\n    });\n    profileData.twitch.onChange({\n      target: {\n        value: profile.twitch\n      }\n    });\n  };\n\n  var getProfile = function getProfile() {\n    ProfileAPI.getProfileData().then(function (response) {\n      setAvatarState(response.data.avatar);\n      setLocalState(_objectSpread({}, response.data));\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  };\n\n  var onSelectFile = function onSelectFile(e) {\n    if (e.target.files && e.target.files[0]) {\n      var form = new FormData();\n      form.append('file', e.target.files[0]);\n      ProfileAPI.setAvatar(form).then(function (response) {\n        setAvatarState(response.data.avatar);\n        var user = JSON.parse(localStorage.getItem('user'));\n        localStorage.setItem('user', JSON.stringify(_objectSpread({}, user, {\n          avatar: response.data.avatar\n        })));\n      })[\"catch\"](function (err) {\n        return console.log(err);\n      });\n    }\n  };\n\n  var editProfile = function editProfile(e) {\n    e.preventDefault();\n    ProfileAPI.editProfileData({\n      nickName: profileData.nickName.value,\n      email: profileData.email.value,\n      facebook: profileData.facebook.value,\n      vk: profileData.vk.value,\n      instagram: profileData.instagram.value,\n      twitch: profileData.twitch.value\n    }).then(function (response) {\n      var user = JSON.parse(localStorage.getItem('user'));\n      localStorage.setItem('user', JSON.stringify(_objectSpread({}, user, {\n        nickName: response.data.nickName\n      })));\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  };\n\n  var getCourse = function getCourse() {\n    LessonsAPI.getMaterials().then(function (response) {\n      store.dispatch(setMaterials(response.data));\n      setLessonURL('/lesson/' + response.data[0].id);\n    })[\"catch\"](function (err) {\n      console.log(err);\n    });\n  };\n\n  useEffect(function () {\n    !materialsState ? getCourse() : null;\n    avatar === null ? getProfile() : null;\n    !lessonsURL && materialsState ? setLessonURL('/lesson/' + materialsState[0].id) : null;\n  });\n  return __jsx(\"div\", {\n    className: styles.profile\n  }, __jsx(\"h1\", null, \"Profile\"), __jsx(\"form\", {\n    className: styles['profile-form'],\n    onSubmit: editProfile\n  }, __jsx(\"div\", {\n    className: styles['avatar-container']\n  }, __jsx(\"img\", {\n    src: avatar ? 'http://194.177.23.9:577/' + avatar : '/static/images/avatar.svg',\n    className: styles.avatar\n  }), __jsx(\"button\", {\n    type: \"button\",\n    className: styles['change-photo-btn']\n  }, \"Change photo\", __jsx(\"input\", {\n    type: \"file\",\n    accept: \"image/x-png,image/gif,image/jpeg\",\n    onChange: onSelectFile\n  })), __jsx(Link, {\n    href: lessonsURL\n  }, __jsx(\"button\", {\n    className: styles['courses-link'] + ' common-btn'\n  }, \"\\u041C\\u043E\\u0438 \\u043A\\u0443\\u0440\\u0441\\u044B\"))), __jsx(\"fieldset\", null, __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.nickName, {\n    placeholder: \"Your Nickname\"\n  })), __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.email, {\n    placeholder: \"Your Email\"\n  })), __jsx(\"div\", {\n    className: 'social-input ' + styles.social\n  }, __jsx(\"img\", {\n    src: \"/static/images/facebook.svg\",\n    alt: \"\"\n  }), __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.facebook, {\n    placeholder: \"Facebook\"\n  }))), __jsx(\"div\", {\n    className: 'social-input ' + styles.social\n  }, __jsx(\"img\", {\n    src: \"/static/images/vk.svg\",\n    alt: \"\"\n  }), __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.vk, {\n    placeholder: \"http://vk.bobik.com\"\n  }))), __jsx(\"div\", {\n    className: 'social-input ' + styles.social\n  }, __jsx(\"img\", {\n    src: \"/static/images/instagram.svg\",\n    alt: \"\"\n  }), __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.instagram, {\n    placeholder: \"Instagram\"\n  }))), __jsx(\"div\", {\n    className: 'social-input ' + styles.social\n  }, __jsx(\"img\", {\n    src: \"/static/images/twitch.svg\",\n    alt: \"\"\n  }), __jsx(\"input\", _extends({\n    type: \"text\",\n    className: \"common-input\"\n  }, profileData.twitch, {\n    placeholder: \"Twitch\"\n  }))), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"purple-btn\"\n  }, \"Save\"))));\n};\n\nexport default Profile;","map":null,"metadata":{},"sourceType":"module"}